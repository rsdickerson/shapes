<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-touch-fullscreen" content="yes"/>
        <meta name="msapplication-tap-highlight" content="no"/>
        <link rel="stylesheet" href="css/style.css"/>
        <link rel="icon" href="favicon.ico" type="image/x-icon"/>
        <script src="js/jquery.js"></script>
        <script src="js/paper.js"></script>
        <script src="js/codemirror.js"></script>
        <script src="js/scripts.js"></script>
        <script>
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-10082945-6']);
            _gaq.push(['_trackPageview']);
            (function() {
             var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
             ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
             var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();
            </script>
        <title>Paper.js â€” Hit Testing</title>
    </head>
    <body class="fullscreen">
        
        <article><div class="paperscript">
            
            <script type="text/paperscript" canvas="canvas-1">
                var values = {
                    paths: 50,
                    minPoints: 5,
                    maxPoints: 15,
                    minRadius: 30,
                    maxRadius: 90
                };
            
            var hitOptions = {
                segments: true,
                stroke: true,
                fill: true,
                tolerance: 5
            };
            
            createPaths();
            
            function createPaths() {
                var radiusDelta = values.maxRadius - values.minRadius;
                var pointsDelta = values.maxPoints - values.minPoints;
                for (var i = 0; i < values.paths; i++) {
                    var radius = values.minRadius + Math.random() * radiusDelta;
                    var points = values.minPoints + Math.floor(Math.random() * pointsDelta);
                    var path = createBlob(view.size * Point.random(), radius, points);
                    var lightness = (Math.random() - 0.5) * 0.4 + 0.4;
                    var hue = Math.random() * 360;
                    path.fillColor = { hue: hue, saturation: 1, lightness: lightness };
                    path.strokeColor = 'black';
                };
            }
            
            function createBlob(center, maxRadius, points) {
                var path = new Path();
                path.closed = true;
                for (var i = 0; i < points; i++) {
                    var delta = new Point({
                                          length: (maxRadius * 0.5) + (Math.random() * maxRadius * 0.5),
                                          angle: (360 / points) * i
                                          });
                                          path.add(center + delta);
                }
                path.smooth();
                return path;
            }
            
            var segment, path;
            var movePath = false;
            function onMouseDown(event) {
                segment = path = null;
                var hitResult = project.hitTest(event.point, hitOptions);
                if (!hitResult)
                return;
                
                if (event.modifiers.shift) {
                    if (hitResult.type == 'segment') {
                        hitResult.segment.remove();
                    };
                    return;
                }
                
                if (hitResult) {
                    path = hitResult.item;
                    if (hitResult.type == 'segment') {
                        segment = hitResult.segment;
                    } else if (hitResult.type == 'stroke') {
                        var location = hitResult.location;
                        segment = path.insert(location.index + 1, event.point);
                        path.smooth();
                    }
                }
                movePath = hitResult.type == 'fill';
                if (movePath)
                project.activeLayer.addChild(hitResult.item);
            }
            
            function onMouseMove(event) {
                project.activeLayer.selected = false;
                if (event.item)
                event.item.selected = true;
            }
            
            function onMouseDrag(event) {
                if (segment) {
                    segment.point += event.delta;
                    path.smooth();
                } else if (path) {
                    path.position += event.delta;
                }
            }
            </script>
            <div class="canvas">
                <canvas resize="true" id="canvas-1" style="background:black"></canvas>
            </div>
        </div>
        </article>
    </body>
</html>